{% extends "Synthese/layout.html.twig" %}



{% block body %}
    {{ parent() }}

    
{% if etablissement is not defined %}

    {% if app.user.isGestionnaire and appVersion>'1.0.0' and advanced_gesionnaire %}
            <h2> Par public</h2>
                <div class="row">

                        {% for referentielPublic in app.user.GestionnaireReferentielsPublic %}

                                  <div class="col-sm-6">
                                      <div id='loader_{{referentielPublic.id}}' class="panel panel-primary">
                                          <div class="panel-heading"><h3 class="panel-title"> <a href="{{ path("pericles3_synthese_referentiel_menu", {'id' : referentielPublic.id }) }}">{{referentielPublic}}</a></h3></div>
                                              <div class="panel-body">
                                                <div class="GraphSyntheseContainer">    
                                                            <canvas id="chartCanvasEtablissements_{{referentielPublic.id}}"  height="220" width="220"></canvas>
                                                </div>
                                                  
        {% set synthese = 'synthese' %}
        <div class="row">
            <div class="col-sm-6">
              <a  href="javascript:genere_document_referentiel('{{synthese}}','doc',{{referentielPublic.id}});" class = "btn  btn-link full-width">(Re)Générer le DOC</a>
                <a  id='{{synthese}}_{{referentielPublic.id}}_doc'  class = "lien_synt btn  btn-danger full-width"  target='blank' 
                    href='{{ path("arsene_synthese_getpath_referentiel", {'id':referentielPublic.id,'synthese_type':synthese,'synthese_extension':'doc'}) }}'>Télécharger le DOC
                </a>
            </div>
            <div class="col-sm-6">
            <a  href="javascript:genere_document_referentiel('{{synthese}}','pdf',{{referentielPublic.id}});" class = "btn  btn-link full-width">(Re)Générer le PDF</a>
            <a  id='{{synthese}}_{{referentielPublic.id}}_pdf'  class = "lien_synt  btn  btn-danger full-width"  target='blank' 
                href='{{ path("arsene_synthese_getpath_referentiel", {'id':referentielPublic.id,'synthese_type':synthese,'synthese_extension':'pdf'}) }}'>Télécharger le PDF</a> 
            </div>
        </div>


                
                            
                                          </div>
                                      </div>
                                                  
                                     
                                                  
                                  </div>
                        {% endfor %}    

                          </div>
                <hr>
    {% endif %}

    <h2> Par établissement</h2>

        <div class="row">

            {%for etablissement in app.user.etablissements %}

                  <div class="col-sm-6">
                      <div class="panel panel-primary">
                          <div class="panel-heading"><h3 class="panel-title"> <a href="{{ path("pericles3_synthese_etablissement",{'id' : etablissement.id}) }}">   <i class='glyphicon glyphicon-queen'></i>  {{etablissement}}</a></h3></div>
                              <div class="panel-body">

                                  <div class="GraphSyntheseContainer">    
                                      <a href="{{ path("pericles3_synthese_etablissement",{'id' : etablissement.id}) }}">   
                                          <canvas id="chartEvalGeneraleCanvas_{{etablissement.id}}" height="220" width="220"></canvas>
                                      </a>
                                  </div>
                          </div>
                      </div>
                  </div>
            {% endfor %}            

        </div>         

      
{% else  %}

        <div class="row">
            {% if etablissement.ReferentielExterne %}
                <div class="col-sm-6">
            {% else %}
                <div class="col-sm-12">
            {% endif  %}
                  <div class="panel panel-primary">
                      <div class="panel-heading">
                          <h3 class="panel-title"> 
                              
                              {% if app.user.hasOneEtablissement%}
                                <a href="{{ path("pericles3_synthese_pericles") }}">{{application_name}}</a>
                              {% else %}
                                <a href="{{ path("pericles3_synthese_arsene_etablissement",  {"id" : etablissement.id})  }}">{{application_name}}</a>
                              {% endif  %}
                                
                          </h3></div>
                              
                          <div class="panel-body">

                              <div class="GraphSyntheseContainer">    
                              {% if app.user.hasOneEtablissement%}
                                <a href="{{ path("pericles3_synthese_pericles") }}">
                              {% else %}
                                <a href="{{ path("pericles3_synthese_arsene_etablissement",  {"id" : etablissement.id})  }}">
                              {% endif  %}
                                      <canvas id="chartEvalGeneraleCanvas" height="220" width="220"></canvas>
                                  </a>
                              </div>
                      </div>
                  </div>
              </div>

              {% if etablissement.ReferentielExterne %}
              <div class="col-sm-6">
                  <div class="panel panel-primary">
                      <div class="panel-heading"><h3 class="panel-title"> 
                            {% if app.user.hasOneEtablissement%}
                                <a href="{{ path("pericles3_synthese_alternatif") }}">
                            {% else %}
                                <a href="{{ path("pericles3_synthese_alternatif_etablissement",  {"id" : etablissement.id})  }}">
                              {% endif  %}
                                  {{etablissement.ReferentielExterne}}</a></h3></div>
                          <div class="panel-body">
                              <div class="GraphSyntheseContainer">    
                                {% if app.user.hasOneEtablissement%}
                                <a href="{{ path("pericles3_synthese_alternatif") }}">
                              {% else %}
                                <a href="{{ path("pericles3_synthese_alternatif_etablissement",  {"id" : etablissement.id})  }}">
                              {% endif  %}
                                      <canvas id="GraphEvalExterne" height="220" width="220"></canvas>
                                  </a>
                              </div>
                      </div>
                  </div>
              </div>
              {% endif  %}
                                      
        </div>



    <div class="row">
        <div class="col-sm-4">
              <div class="panel panel-primary">
                  <div class="panel-heading"><h3 class="panel-title">
                            {% if app.user.hasOneEtablissement%}
                                <a href="{{ path("pericles3_synthese_export_page") }}">
                              {% else %}
                                <a href="{{ path("pericles3_synthese_export_page_etablissement",  {"id" : etablissement.id})  }}">
                              {% endif  %}
                              Production des rapports</a></h3></div>
                      <div class="panel-body">
                          
                            {% if app.user.hasOneEtablissement%}
                                <a href="{{ path("pericles3_synthese_export_page") }}">
                              {% else %}
                                <a href="{{ path("pericles3_synthese_export_page_etablissement",  {"id" : etablissement.id})  }}">
                              {% endif  %}
                                  <div class='alert alert-info'>Exportation en pdf, doc, html....</div>
                              </a>
                  </div>
              </div>
          </div>
        <div class="col-sm-4">
              <div class="panel panel-primary">
                  <div class="panel-heading"><h3 class="panel-title"> Annexes au rapport d'activité</h3></div>
                      <div class="panel-body">
                            {% if etablissement.NbSauvegardes == 0 %}
                                <div class='alert alert-warning'>Vous devez avoir effectué au moins une sauvegarde pour acceder au annexes</div>
                            {% else  %}
                            {% if app.user.hasOneEtablissement%}
                                <a href="{{ path("pericles3_annexes") }}">
                              {% else %}
                                <a href="{{ path('pericles3_synthese_alternatif_etablissement', {'id': etablissement.id})}}">
                              {% endif  %}
                                  <div class='alert alert-info'>Faire un état des évolutions entre une sauvegarde et la moment présent</div>
                              </a>
                            {% endif %}
                  </div>
              </div>

          </div>
                                  
        <div class="col-sm-4">
            {% include "Synthese/Sauvegardes/inc_panel_sauvegarde.html.twig" %}
        </div> 

    </div>         

    {% endif %}


{% endblock %}



{% block javascripts %}
    
    <script type="text/javascript">
      {% include "Synthese/inc_options_charts.js.twig" %}
      {% if etablissement is not defined %}
                    {%for etablissement in app.user.etablissements %}
                       {{ etablissement.domaines  | order | graph('chartEvalGeneraleCanvas_' ~ etablissement.id) | raw }}
                 {% endfor %}

        {% else %}
            {{ domaines  | order | graph('chartEvalGeneraleCanvas') |raw }}
            {{ etablissement.domainesExterne | order | graph('GraphEvalExterne') |raw }}
        {% endif %}
 

        {% if app.user.isGestionnaire  and appVersion>'1.0.0' and etablissement is not defined  %}
            {% for referentielPublic in referentielsPublic %}
                {{ etabsByRef[referentielPublic.id] | graph('chartCanvasEtablissements_' ~ referentielPublic.id,true,'options_responsive') |raw }}
            {% endfor %}
        {% endif %}

    {% set wgraph =false%}
    {% include "Synthese/inc_javascritp_export_referentiel.js.twig" %}


           </script>
{% endblock %}
